# 后端接口测试执行计划 - 供应商管理模块

## 任务概述
完成 `day7-plan.md` 任务 5.1：为供应商管理模块创建完整的后端接口测试，包括 Controller 和 Service 层测试，确保代码质量和覆盖率 > 80%。

## 执行步骤

### 步骤 1：创建 SupplierInfoControllerTest 测试类
**文件路径**: `backend/src/test/java/com/haocai/management/controller/SupplierInfoControllerTest.java`

**测试用例清单** (参考 SysUserControllerTest 的结构):

#### 1.1 供应商创建接口测试 (3个测试)
- testCreateSupplier_Success: 正常创建供应商
- testCreateSupplier_CodeDuplicate: 供应商编码重复
- testCreateSupplier_ValidationFailed: 参数验证失败（供应商名称为空）

#### 1.2 供应商更新接口测试 (3个测试)
- testUpdateSupplier_Success: 正常更新供应商
- testUpdateSupplier_NotFound: 供应商不存在
- testUpdateSupplier_CodeDuplicate: 编码重复

#### 1.3 供应商删除接口测试 (3个测试)
- testDeleteSupplier_Success: 正常删除供应商
- testDeleteSupplier_NotFound: 供应商不存在
- testDeleteSupplier_HasRelatedData: 有关联耗材（Mock抛出异常）

#### 1.4 供应商查询接口测试 (4个测试)
- testGetSupplierById_Success: 获取供应商详情
- testGetSupplierById_NotFound: 供应商不存在
- testGetSupplierPage_Success: 分页查询
- testSearchSuppliers_Success: 搜索供应商

#### 1.5 供应商状态管理接口测试 (3个测试)
- testToggleStatus_Success: 切换状态
- testUpdateStatus_Success: 更新状态
- testBatchUpdateStatus_Success: 批量更新状态

#### 1.6 供应商编码生成接口测试 (2个测试)
- testGenerateSupplierCode_Success: 正常生成编码
- testCheckSupplierCode_Exists: 检查编码存在

#### 1.7 边界条件测试 (4个测试)
- testBatchOperation_EmptyList: 批量操作空列表
- testCreateSupplier_TooLongName: 超长供应商名称
- testGetSupplierPage_LargePageNumber: 超大页码
- testGetSupplierPage_NegativePageNumber: 负数页码

#### 1.8 性能测试 (2个测试)
- testPerformance_BatchQuery1000: 批量查询1000条记录
- testPerformance_BatchDelete1000: 批量删除1000条记录

#### 1.9 异常处理测试 (3个测试)
- testExceptionHandling_NullPointerException: Service层抛出空指针异常
- testExceptionHandling_IllegalArgumentException: Service层抛出非法参数异常
- testExceptionHandling_RuntimeException: Service层抛出运行时异常

### 步骤 2：创建 SupplierEvaluationServiceTest 测试类
**文件路径**: `backend/src/test/java/com/haocai/management/service/SupplierEvaluationServiceTest.java`

**测试用例清单**:

#### 2.1 评价创建测试 (3个测试)
- testCreateEvaluation_Success: 正常创建评价
- testCreateEvaluation_ScoreOutOfRange: 评分范围错误
- testCreateEvaluation_SupplierNotFound: 供应商不存在

#### 2.2 评价查询测试 (2个测试)
- testGetEvaluationsBySupplierId_Success: 根据供应商ID查询评价
- testGetEvaluationsByEvaluatorId_Success: 根据评价人ID查询评价

#### 2.3 评价删除测试 (2个测试)
- testDeleteEvaluation_Success: 正常删除评价
- testDeleteEvaluation_NotFound: 评价不存在

#### 2.4 信用等级计算测试 (10个测试)
- testCalculateCreditRating_10: 平均分9.0-10.0 → 信用等级10
- testCalculateCreditRating_9: 平均分8.0-8.9 → 信用等级9
- testCalculateCreditRating_8: 平均分7.0-7.9 → 信用等级8
- testCalculateCreditRating_7: 平均分6.0-6.9 → 信用等级7
- testCalculateCreditRating_6: 平均分5.0-5.9 → 信用等级6
- testCalculateCreditRating_5: 平均分4.0-4.9 → 信用等级5
- testCalculateCreditRating_4: 平均分3.0-3.9 → 信用等级4
- testCalculateCreditRating_3: 平均分2.0-2.9 → 信用等级3
- testCalculateCreditRating_2: 平均分1.0-1.9 → 信用等级2
- testCalculateCreditRating_1: 平均分0.0-0.9 → 信用等级1

### 步骤 3：执行测试并生成覆盖率报告
```bash
cd backend
mvn clean test jacoco:report
```

### 步骤 4：验证测试结果
- 检查所有测试用例是否通过
- 检查测试覆盖率是否 > 80%
- 查看覆盖率报告：`backend/target/site/jacoco/index.html`

### 步骤 5：创建开发记录文档
**文件路径**: `docs/day7/supplier-backend-test-report.md`

## 遵循的规范条款
1. **测试规范-第6条**：必须测试字段映射、类型转换、批量操作
2. **控制层规范-第4.1条**：批量操作接口规范
3. **控制层规范-第4.2条**：异常处理规范
4. **后端开发规范-第2.3条**：参数校验：使用@Validated和JSR-303注解

## 预期交付物
1. SupplierInfoControllerTest.java (约25个测试用例)
2. SupplierEvaluationServiceTest.java (约17个测试用例)
3. 测试覆盖率报告 (JaCoCo HTML报告)
4. 开发记录文档 (supplier-backend-test-report.md)