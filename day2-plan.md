# 第二天工作计划：基础管理模块开发 - 用户管理

## 日期：2026年1月7日

## 总体目标
完成用户管理模块的开发，实现用户注册、登录、权限验证等核心功能，为后续模块开发奠定基础。

## 详细工作任务

### 1. 后端用户管理模块开发（预计4小时）

#### 1.1 用户实体类设计（预计1小时）✅ 已完成
- [x] 创建用户实体类 `SysUser`
  - 用户基本信息字段：id、username、password、realName、email、phone、avatar ✅
  - 用户状态字段：status（正常/禁用/锁定）、createTime、updateTime、lastLoginTime ✅
  - 用户关联字段：departmentId ✅
  - 使用Lombok注解简化代码 ✅
  - 配置JPA注解和表映射 ✅
- [x] 创建用户DTO类
  - `UserLoginDTO`：登录请求 ✅
  - `UserRegisterDTO`：注册请求 ✅
  - `UserUpdateDTO`：用户信息更新 ✅
  - `UserVO`：用户信息响应 ✅
- [x] 配置实体类验证注解
  - 用户名长度验证 ✅
  - 邮箱格式验证 ✅
  - 手机号格式验证 ✅
- [x] 创建UserStatus枚举类
  - 定义用户状态枚举 ✅
  - 提供状态转换方法 ✅
- [x] 编译测试通过 ✅
- [x] 创建开发教程文档 ✅

#### 1.2 用户数据访问层（预计1小时）
- [ ] 创建用户Mapper接口 `SysUserMapper`
  - 继承BaseMapper获得基础CRUD方法
  - 自定义查询方法：根据用户名查询、根据状态查询、分页查询
  - 配置MyBatis-Plus注解
- [ ] 创建用户Repository接口 `SysUserRepository`
  - 继承JpaRepository获得JPA方法
  - 自定义查询方法：根据用户名查找、根据邮箱查找
- [ ] 配置数据访问层异常处理

#### 1.3 用户业务逻辑层（预计1.5小时）
- [ ] 创建用户Service接口 `ISysUserService`
  - 定义用户业务方法接口
- [ ] 创建用户Service实现类 `SysUserServiceImpl`
  - 用户注册逻辑（密码加密、用户名唯一性检查）
  - 用户登录逻辑（密码验证、生成JWT token）
  - 用户信息更新逻辑
  - 用户状态管理逻辑
  - 用户列表查询逻辑（分页、搜索、筛选）
- [ ] 密码加密配置
  - 配置BCryptPasswordEncoder
  - 密码加密和验证方法
- [ ] 用户登录日志记录
  - 登录成功/失败记录
  - 登录IP、时间记录

#### 1.4 用户控制层（预计0.5小时）
- [ ] 创建用户Controller `SysUserController`
  - 用户注册接口 `/api/user/register`
  - 用户登录接口 `/api/user/login`
  - 获取用户信息接口 `/api/user/info`
  - 更新用户信息接口 `/api/user/update`
  - 用户列表接口 `/api/user/list`
  - 用户状态切换接口 `/api/user/status`
- [ ] 配置接口权限注解
  - 登录接口公开访问
  - 其他接口需要认证
- [ ] 统一响应格式封装

### 2. JWT认证机制实现（预计2小时）

#### 2.1 JWT工具类开发（预计1小时）
- [ ] 创建JWT工具类 `JwtUtils`
  - 生成JWT token方法
  - 解析JWT token方法
  - 验证token有效性方法
  - 刷新token方法
  - 从token中提取用户信息
- [ ] 配置JWT参数
  - 密钥配置
  - token过期时间配置
  - 刷新token过期时间配置

#### 2.2 Spring Security配置（预计1小时）
- [ ] 创建安全配置类 `SecurityConfig`
  - 配置密码编码器
  - 配置认证管理器
  - 配置JWT过滤器
  - 配置跨域访问
  - 配置请求授权规则
- [ ] 创建JWT认证过滤器 `JwtAuthenticationFilter`
  - 拦截请求验证token
  - 设置认证上下文
  - 处理token过期
- [ ] 创建自定义认证提供者
  - 实现用户名密码认证
  - 集成JWT token验证

### 3. 前端用户管理页面开发（预计3小时）

#### 3.1 登录页面开发（预计1小时）
- [ ] 创建登录页面组件 `LoginView.vue`
  - 用户名密码输入框
  - 登录按钮和加载状态
  - 表单验证（必填、格式验证）
  - 错误提示显示
  - 记住密码功能
- [ ] 配置登录路由
  - 登录页面路由配置
  - 未登录重定向处理
- [ ] 实现登录逻辑
  - 调用后端登录接口
  - token存储到localStorage
  - 登录成功跳转到首页

#### 3.2 用户管理页面开发（预计1.5小时）
- [ ] 创建用户管理页面 `UserManage.vue`
  - 用户列表表格（支持分页）
  - 搜索功能（按用户名、姓名、状态搜索）
  - 新增用户弹窗表单
  - 编辑用户弹窗表单
  - 删除用户确认对话框
  - 用户状态切换功能
- [ ] 配置用户管理路由
  - 添加到路由配置中
  - 配置页面权限
- [ ] 实现用户管理API调用
  - 获取用户列表
  - 新增用户
  - 更新用户
  - 删除用户
  - 切换用户状态

#### 3.3 全局认证状态管理（预计0.5小时）
- [ ] 更新Pinia store
  - 添加用户状态管理
  - token管理方法
  - 用户信息管理方法
- [ ] 配置路由守卫
  - 检查登录状态
  - 自动刷新token
  - 未登录跳转登录页

### 4. 数据库表结构完善（预计1小时）

#### 4.1 用户相关表结构
- [ ] 检查并完善用户表 `sys_user`
  - 确认所有字段定义正确
  - 检查索引配置
  - 验证外键约束
- [ ] 添加用户登录日志表 `sys_user_login_log`
  - 日志ID、用户ID、登录时间、登录IP、登录结果、失败原因
- [ ] 执行数据库脚本更新
  - 更新init.sql脚本
  - 执行数据库迁移

### 5. 功能测试和联调（预计1小时）

#### 5.1 后端接口测试
- [ ] 用户注册接口测试
- [ ] 用户登录接口测试
- [ ] JWT token验证测试
- [ ] 用户信息查询测试
- [ ] 用户更新接口测试

#### 5.2 前端功能测试
- [ ] 登录页面功能测试
- [ ] 用户管理页面功能测试
- [ ] 认证状态保持测试
- [ ] 路由守卫测试

#### 5.3 前后端联调测试
- [ ] 登录流程完整测试
- [ ] 用户管理CRUD测试
- [ ] 权限验证测试
- [ ] 异常处理测试

## 验收标准
- [ ] 用户能正常注册账号
- [ ] 用户能正常登录系统，获得JWT token
- [ ] JWT token能正确验证用户身份
- [ ] 用户管理页面能正常显示用户列表
- [ ] 能新增、编辑、删除用户
- [ ] 用户状态能正常切换
- [ ] 未登录用户自动跳转登录页
- [ ] 所有接口都有相应权限控制
- [ ] 前后端联调测试通过

## 技术要点
- JWT无状态认证机制
- BCrypt密码加密
- Spring Security权限控制
- MyBatis-Plus数据访问
- Vue 3 Composition API
- Element Plus组件库
- Pinia状态管理
- TypeScript类型安全

## 注意事项
- 密码必须使用BCrypt加密存储
- JWT token有过期时间，需要处理刷新逻辑
- 用户名和邮箱需要唯一性验证
- 前端需要处理token过期的情况
- 数据库字段长度要合理设置
- 接口要做好参数验证和错误处理

## 预计完成时间
18:00 - 用户管理模块开发完成并测试通过

## 风险评估
- JWT配置不当可能导致安全问题
- 密码加密算法选择影响安全性
- 前端token管理不当可能导致用户体验问题
- 数据库设计不合理影响后续扩展

## 依赖检查
- 确保Spring Security依赖正确配置
- 确保JWT相关依赖版本兼容
- 确保前端Axios拦截器配置正确
- 确保数据库表结构与实体类匹配