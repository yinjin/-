# 第十四天工作计划：数据大屏模块开发

## 日期：2026年1月19日

## 总体目标
完成数据大屏模块的开发，实现实时数据展示、图表可视化、自动刷新等核心功能，建立完整的数据大屏展示系统，为管理决策提供数据支持。

## 详细工作任务

### 1. 后端大屏数据接口开发（预计3小时）

#### 1.1 大屏数据DTO设计（预计0.5小时）
- [ ] 创建大屏数据DTO类
  - `DashboardOverviewDTO`：概览数据
    - 今日入库数量
    - 今日出库数量
    - 本月入库金额
    - 本月出库金额
    - 库存总价值
    - 库存预警数量
    - 待处理申请数量
    - 待归还数量
  - `TopMaterialDTO`：Top耗材数据
    - 耗材ID
    - 耗材名称
    - 耗材编码
    - 数量/频次
    - 排名
  - `ChartDataDTO`：图表数据
    - 图表类型（饼图/折线图/柱状图）
    - 数据标签
    - 数据值
    - 时间范围
  - `WarningMaterialDTO`：预警耗材数据
    - 耗材ID
    - 耗材名称
    - 耗材编码
    - 当前库存
    - 安全库存
    - 预警类型（低库存/临期）
    - 预警级别（高/中/低）
- [ ] 创建开发文档

#### 1.2 大屏数据Service层开发（预计1.5小时）
- [ ] 创建大屏数据Service接口`IDashboardService`
  ```java
  - getOverviewData() - 获取概览数据
  - getTopUsedMaterials(Integer limit) - 获取最常用耗材Top5
  - getTopStockMaterials(Integer limit) - 获取库存最多耗材Top5
  - getLowStockMaterials(Integer limit) - 获取库存最少耗材Top5
  - getCategoryRatio() - 获取耗材分类占比
  - getUsageTrend(Integer days) - 获取出库趋势数据
  - getUsageTypeRatio() - 获取用途分类占比
  - getWarningList() - 获取库存预警列表
  - getInOutComparison(Integer days) - 获取入库出库对比数据
  - getMonthlyStatistics(Integer months) - 获取月度统计数据
  ```
- [ ] 创建大屏数据Service实现类`DashboardServiceImpl`
  - 实现概览数据查询逻辑
    - 查询今日入库数量（从入库明细表）
    - 查询今日出库数量（从出库明细表）
    - 查询本月入库金额（从入库明细表）
    - 查询本月出库金额（从出库明细表）
    - 查询库存总价值（从库存表）
    - 查询库存预警数量（从库存表）
    - 查询待处理申请数量（从出库单表）
    - 查询待归还数量（从出库明细表）
  - 实现Top耗材查询逻辑
    - 最常用耗材：按出库频次排序
    - 库存最多耗材：按库存数量排序
    - 库存最少耗材：按库存数量排序
    - 使用SQL窗口函数或子查询
  - 实现图表数据查询逻辑
    - 耗材分类占比：按分类统计库存数量
    - 出库趋势：按日期统计出库数量
    - 用途分类占比：按用途统计出库数量
    - 入库出库对比：按日期统计入库和出库数量
  - 实现预警列表查询逻辑
    - 低库存预警：库存数量 < 安全库存
    - 临期预警：保质期 < 30天
    - 按预警级别排序
  - 实现月度统计查询逻辑
    - 按月份统计入库和出库数据
    - 计算环比增长率
  - 添加业务异常处理
  - 添加详细日志记录
- [ ] 创建开发文档

#### 1.3 大屏数据Controller层开发（预计0.5小时）
- [ ] 创建大屏数据Controller`DashboardController`
  ```java
  @RestController
  @RequestMapping("/api/dashboard")
  @Tag(name = "数据大屏", description = "数据大屏接口")
  ```
- [ ] 实现以下API接口：
  ```java
  GET    /api/dashboard/overview              - 获取概览数据
  GET    /api/dashboard/top-used              - 获取最常用耗材Top5
  GET    /api/dashboard/top-stock             - 获取库存最多耗材Top5
  GET    /api/dashboard/low-stock             - 获取库存最少耗材Top5
  GET    /api/dashboard/category-ratio        - 获取耗材分类占比
  GET    /api/dashboard/usage-trend           - 获取出库趋势数据
  GET    /api/dashboard/usage-type            - 获取用途分类占比
  GET    /api/dashboard/warning-list          - 获取库存预警列表
  GET    /api/dashboard/in-out-comparison     - 获取入库出库对比数据
  GET    /api/dashboard/monthly-statistics    - 获取月度统计数据
  ```
- [ ] 添加接口文档注解
  - 使用@Tag、@Operation、@Parameter等注解
  - 完善接口说明文档
- [ ] 添加权限控制注解
  - 使用@PreAuthorize控制接口访问权限
  - 例如：@PreAuthorize("hasAuthority('dashboard:view')")
- [ ] 创建开发文档

#### 1.4 数据缓存优化（预计0.5小时）
- [ ] 配置Redis缓存
  - 配置缓存管理器
  - 配置缓存过期时间
  - 配置缓存键生成策略
- [ ] 实现缓存策略
  - 概览数据缓存（5分钟过期）
  - Top耗材数据缓存（10分钟过期）
  - 图表数据缓存（5分钟过期）
  - 预警列表缓存（3分钟过期）
- [ ] 实现缓存预热
  - 系统启动时加载热点数据
  - 定时刷新缓存
- [ ] 实现缓存穿透防护
  - 使用布隆过滤器
  - 空值缓存
- [ ] 实现缓存雪崩防护
  - 设置随机过期时间
  - 降级策略
- [ ] 创建开发文档

### 2. 前端大屏页面开发（预计4小时）

#### 2.1 大屏页面布局（预计1小时）
- [ ] 创建大屏页面组件`Dashboard.vue`
  - 全屏布局设计
    - 顶部标题栏
    - 左侧数据面板
    - 中间图表区域
    - 右侧数据面板
  - 响应式适配
    - 1080P适配
    - 4K适配
    - 移动端适配
  - 自适应网格布局
  - 主题切换（深色/浅色模式）
- [ ] 配置大屏路由
  - 添加到路由配置中
  - 配置页面权限
- [ ] 创建开发文档

#### 2.2 数据展示组件开发（预计2小时）
- [ ] 创建概览卡片组件`OverviewCard.vue`
  - 今日入库数量卡片
  - 今日出库数量卡片
  - 本月入库金额卡片
  - 本月出库金额卡片
  - 库存总价值卡片
  - 库存预警数量卡片
  - 待处理申请数量卡片
  - 待归还数量卡片
  - 数字滚动动画
  - 图标展示
- [ ] 创建Top列表组件`TopList.vue`
  - 最常用耗材Top5列表
  - 库存最多耗材Top5列表
  - 库存最少耗材Top5列表
  - 排名展示
  - 数量展示
  - 趋势图标
- [ ] 创建图表组件封装
  - 饼图组件`PieChart.vue`
    - 耗材分类占比饼图
    - 用途分类占比饼图
  - 折线图组件`LineChart.vue`
    - 出库趋势折线图
    - 入库出库对比折线图
  - 柱状图组件`BarChart.vue`
    - 月度入库出库柱状图
    - 用途分类柱状图
  - 雷达图组件`RadarChart.vue`（可选）
- [ ] 创建预警列表组件`WarningList.vue`
  - 库存预警列表
  - 实时滚动
  - 预警级别标识
  - 预警类型标识
  - 点击查看详情
- [ ] 创建开发文档

#### 2.3 自动刷新和交互（预计1小时）
- [ ] 实现定时刷新数据
  - 配置刷新间隔（可配置）
  - 使用setInterval定时刷新
  - 刷新时显示加载动画
- [ ] 实现手动刷新按钮
  - 刷新按钮
  - 刷新状态提示
  - 刷新成功提示
- [ ] 实现数据更新提示
  - 数据变化提示
  - Toast消息提示
- [ ] 实现时间范围切换
  - 近7天/30天/90天切换
  - 切换时重新加载数据
- [ ] 实现页面性能优化
  - 懒加载
  - 虚拟滚动
  - 防抖节流
- [ ] 创建开发文档

### 3. 功能测试和联调（预计1.5小时）

#### 3.1 后端接口测试
- [ ] 创建测试类`DashboardServiceTest`
  - 概览数据查询测试
  - Top耗材查询测试
  - 图表数据查询测试
  - 预警列表查询测试
  - 月度统计查询测试
- [ ] 创建测试类`DashboardControllerTest`
  - 大屏数据接口测试
  - 缓存功能测试
  - 性能测试
- [ ] 执行测试并验证结果
- [ ] 生成测试覆盖率报告
- [ ] 创建开发文档

#### 3.2 前端功能测试
- [ ] 大屏页面功能测试
  - 概览数据显示测试
  - Top列表显示测试
  - 图表渲染测试
  - 预警列表显示测试
  - 自动刷新功能测试
  - 手动刷新功能测试
  - 时间范围切换测试
- [ ] 响应式适配测试
  - 1080P适配测试
  - 4K适配测试
  - 移动端适配测试
- [ ] 主题切换测试
  - 深色模式测试
  - 浅色模式测试
- [ ] 创建开发文档

#### 3.3 前后端联调测试
- [ ] 数据准确性测试
  - 概览数据准确性测试
  - Top耗材数据准确性测试
  - 图表数据准确性测试
  - 预警列表准确性测试
- [ ] 数据实时性测试
  - 缓存刷新时间测试
  - 自动刷新功能测试
  - 数据更新延迟测试
- [ ] 图表展示测试
  - 饼图展示测试
  - 折线图展示测试
  - 柱状图展示测试
  - 图表交互测试
- [ ] 性能测试
  - 接口响应时间测试（<1秒）
  - 页面加载时间测试（<3秒）
  - 并发访问测试（100+用户）
  - 内存占用测试
- [ ] 浏览器兼容性测试
  - Chrome测试
  - Firefox测试
  - Safari测试
  - Edge测试
- [ ] 创建开发文档

## 验收标准
- [ ] 数据展示准确（数据一致性）
- [ ] 图表渲染正常（样式正确、交互流畅）
- [ ] 自动刷新有效（数据实时更新）
- [ ] 页面响应流畅（60FPS）
- [ ] 接口性能达标（响应时间<1秒）
- [ ] 缓存机制有效（减少数据库查询）
- [ ] 响应式适配正常（不同分辨率）
- [ ] 所有接口都有相应权限控制
- [ ] 前后端联调测试通过
- [ ] 测试覆盖率 > 80%

## 技术要点
- ECharts图表库
- Redis缓存优化
- 缓存预热策略
- 缓存穿透防护
- 缓存雪崩防护
- 定时刷新机制
- 数字滚动动画
- 响应式设计
- 虚拟滚动
- 防抖节流
- Vue 3 Composition API
- TypeScript类型安全
- 前端性能优化

## 注意事项
- 大屏数据查询需要优化SQL性能
- 图表数据需要格式化处理
- 缓存过期时间需要合理设置
- 自动刷新间隔需要合理设置
- 前端需要处理数据加载状态
- 前端需要处理错误状态
- 图表需要适配不同分辨率
- 数字滚动动画需要流畅
- 预警列表需要实时更新
- 性能优化需要持续关注

## 预计完成时间
18:00 - 数据大屏模块开发完成并测试通过

## 风险评估
- 大屏数据查询可能存在性能瓶颈
- 图表渲染可能存在性能问题
- 缓存策略可能影响数据实时性
- 自动刷新可能增加服务器压力
- 响应式适配可能存在兼容性问题
- 前端性能优化需要充分测试
- 异常处理需要全面

## 依赖检查
- 确保入库明细表数据正确
- 确保出库明细表数据正确
- 确保库存表数据正确
- 确保耗材表数据正确
- 确保Redis配置正确
- 确保ECharts依赖正确
- 确保前端路由配置正确
- 确保前端API调用正确

## 开发流程规范
1. **开发前准备**
   - 阅读相关文档和代码
   - 理解业务逻辑和技术要点
   - 准备测试数据

2. **开发过程**
   - 按照任务清单逐步开发
   - 每完成一个功能立即测试
   - 遇到问题及时记录和解决
   - 代码提交前务必测试通过

3. **测试要求**
   - 本地测试：所有功能在本地进行完整测试
   - 自动化测试：编写自动化测试脚本
   - 推送前验证：确保本地测试全部通过
   - 部署测试：代码推送后触发CI流程

4. **文档要求**
   - 开发记录：记录实现思路、关键代码变更、依赖调整
   - 测试记录：记录测试工具、测试方法、测试结果
   - 文档更新：同步更新技术文档、API文档

5. **质量要求**
   - 代码审查：所有合并请求需经过审查
   - 测试覆盖率：单元测试覆盖率 > 80%
   - 性能要求：接口响应时间 < 1秒，页面加载 < 3秒

## 相关文档
- docs/common/plan.md - 系统整体规划
- docs/day8/day8-plan.md - 库存管理基础功能
- docs/day10/day10-plan.md - 入库管理模块开发
- docs/day11/day11-plan.md - 出库管理模块开发（上）
- docs/day12/day12-plan.md - 出库管理模块开发（下）
- docs/day13/day13-plan.md - 库存盘点模块开发
