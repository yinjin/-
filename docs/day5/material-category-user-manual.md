# 耗材分类管理用户手册

## 版本信息
- **版本号**: v1.1
- **更新日期**: 2026-01-09
- **更新内容**: 功能增强、用户体验优化

## 目录
1. [功能概述](#功能概述)
2. [权限说明](#权限说明)
3. [操作指南](#操作指南)
4. [常见问题](#常见问题)
5. [更新说明](#更新说明)

---

## 功能概述

耗材分类管理模块提供了完整的耗材分类管理功能，支持：

- ✅ 分类树形结构展示
- ✅ 分类增删改查
- ✅ 分类层级管理（最多3级）
- ✅ 分类状态管理（启用/禁用）
- ✅ 分类编码自动生成
- ✅ 分类编码唯一性验证
- ✅ 分类移动（更改父分类）
- ✅ 分类搜索和过滤
- ✅ 批量删除

---

## 权限说明

### 权限类型

| 权限名称 | 权限编码 | 功能说明 |
|---------|---------|---------|
| 查看耗材分类 | material-category:view | 查看分类列表、详情、树形结构 |
| 创建耗材分类 | material-category:create | 新增分类、新增子分类 |
| 编辑耗材分类 | material-category:edit | 更新分类信息、切换状态 |
| 删除耗材分类 | material-category:delete | 删除分类、批量删除 |

### 权限使用场景

#### 查看权限
- 查看耗材分类列表
- 查看分类树形结构
- 查看分类详情
- 搜索和过滤分类

#### 创建权限
- 新增顶级分类
- 新增子分类
- 自动生成分类编码

#### 编辑权限
- 编辑分类信息
- 更新分类的父分类
- 切换分类状态（启用/禁用）

#### 删除权限
- 删除单个分类
- 批量删除分类

---

## 操作指南

### 1. 查看耗材分类

#### 1.1 查看分类树
1. 登录系统后，进入"耗材管理" > "耗材分类管理"
2. 系统自动加载耗材分类树形结构
3. 分类树默认展开所有节点

#### 1.2 搜索分类
1. 在搜索表单中输入分类名称或分类编码
2. 系统自动过滤匹配的分类
3. 支持按状态过滤（启用/禁用）

#### 1.3 展开/折叠分类
- 点击"展开全部"按钮：展开所有分类节点
- 点击"折叠全部"按钮：折叠所有分类节点

---

### 2. 新增耗材分类

#### 2.1 新增顶级分类
1. 点击"新增分类"按钮
2. 填写分类信息：
   - **分类名称**（必填）：输入分类名称
   - **分类编码**（可选）：输入分类编码，不填则自动生成
   - **排序号**：设置分类排序顺序
   - **分类描述**：输入分类描述信息
   - **状态**：选择启用或禁用
3. 点击"确定"按钮保存

#### 2.2 新增子分类
1. 在分类树中找到父分类
2. 点击父分类右侧的"新增子分类"按钮
3. 填写分类信息（同上）
4. 点击"确定"按钮保存

**注意事项**：
- 分类层级最多支持3级
- 分类编码不能重复
- 系统会自动检查编码唯一性

---

### 3. 编辑耗材分类

#### 3.1 编辑分类信息
1. 在分类树中找到要编辑的分类
2. 点击分类右侧的"编辑"按钮
3. 修改分类信息：
   - **分类名称**：修改分类名称
   - **分类编码**：修改分类编码
   - **父分类**：更改父分类（可移动到其他分类下或顶级）
   - **排序号**：修改排序顺序
   - **分类描述**：修改描述信息
   - **状态**：修改状态
4. 点击"确定"按钮保存

#### 3.2 更改父分类
1. 在编辑弹窗中，点击"父分类"下拉框
2. 选择新的父分类
3. 系统会自动检查：
   - 是否产生循环引用（不能将分类移动到自己的子分类下）
   - 分类层级是否超过3级
4. 点击"确定"按钮保存

**注意事项**：
- 不能将分类移动到自己的子分类下
- 移动后分类层级不能超过3级
- 系统会自动更新分类层级

---

### 4. 删除耗材分类

#### 4.1 删除单个分类
1. 在分类树中找到要删除的分类
2. 点击分类右侧的"删除"按钮
3. 系统会检查分类下是否有子分类
4. 如果有子分类，会提示"该分类下存在子分类，请先删除子分类"
5. 如果没有子分类，会弹出确认对话框
6. 点击"确定"按钮删除

#### 4.2 批量删除分类
1. 勾选要删除的分类（暂未实现）
2. 点击"批量删除"按钮
3. 系统会检查所有分类下是否有子分类
4. 如果有子分类，会提示哪些分类不能删除
5. 点击"确定"按钮删除

**注意事项**：
- 分类下有子分类时不能删除
- 删除操作为逻辑删除，数据不会物理删除

---

### 5. 切换分类状态

#### 5.1 启用/禁用分类
1. 在分类树中找到要切换状态的分类
2. 点击分类右侧的"启用"或"禁用"按钮
3. 系统会显示提示信息："已启用分类"或"已禁用分类"
4. 分类状态立即更新

**注意事项**：
- 禁用的分类不会影响其子分类
- 禁用的分类在列表中会显示为灰色

---

### 6. 分类编码管理

#### 6.1 自动生成编码
- 新增分类时，如果不填写分类编码，系统会自动生成
- 编码规则：
  - 一级分类：A01, A02, ..., A99
  - 二级分类：A01-01, A01-02, ..., A01-99
  - 三级分类：A01-01-01, A01-01-02, ..., A01-01-99

#### 6.2 手动输入编码
- 新增或编辑分类时，可以手动输入分类编码
- 系统会自动检查编码唯一性
- 如果编码已存在，会显示错误提示

#### 6.3 编码唯一性验证
- 输入编码后，系统会自动验证
- 验证结果会实时显示
- 如果编码已存在，会显示"该分类编码已存在"错误提示

---

## 常见问题

### Q1: 为什么不能删除某个分类？
**A**: 如果分类下有子分类，则不能删除。需要先删除所有子分类后，才能删除父分类。

### Q2: 为什么不能将分类移动到某个父分类下？
**A**: 可能的原因：
1. 会产生循环引用（不能将分类移动到自己的子分类下）
2. 移动后分类层级会超过3级

### Q3: 分类编码有什么作用？
**A**: 分类编码用于唯一标识分类，方便系统内部管理和数据关联。建议使用系统自动生成的编码。

### Q4: 最多支持几级分类？
**A**: 最多支持3级分类（一级、二级、三级）。

### Q5: 禁用分类后，子分类会受影响吗？
**A**: 不会。禁用父分类不会影响子分类的状态，子分类可以独立启用或禁用。

### Q6: 如何快速找到某个分类？
**A**: 使用搜索功能：
1. 在搜索框中输入分类名称或编码
2. 系统会自动过滤匹配的分类
3. 也可以按状态过滤（启用/禁用）

### Q7: 分类编码可以修改吗？
**A**: 可以。编辑分类时可以修改分类编码，但需要确保编码唯一。

### Q8: 删除的分类可以恢复吗？
**A**: 删除操作为逻辑删除，数据不会物理删除。如需恢复，请联系系统管理员。

---

## 更新说明

### v1.1 (2026-01-09)

#### 新增功能
- ✅ 支持更新分类的父分类ID
- ✅ 添加循环引用检查，防止数据错误
- ✅ 添加分类层级自动更新功能
- ✅ 父分类选择器添加"顶级分类"选项

#### 优化改进
- ✅ 编码检查添加防抖功能，减少不必要的请求
- ✅ 状态切换提示更明确，显示"已启用分类"或"已禁用分类"
- ✅ 搜索过滤添加状态过滤功能
- ✅ 异常处理更规范，错误信息更清晰

#### 权限更新
- ✅ 权限细粒度控制：从`material`细化为`material-category:view/create/edit/delete`
- ✅ 需要在权限管理系统中配置新的细粒度权限

### v1.0 (2026-01-08)

#### 初始功能
- ✅ 分类树形结构展示
- ✅ 分类增删改查
- ✅ 分类层级管理（最多3级）
- ✅ 分类状态管理（启用/禁用）
- ✅ 分类编码自动生成
- ✅ 分类编码唯一性验证
- ✅ 分类搜索和过滤

---

## 技术支持

如有问题或建议，请联系：
- **技术支持邮箱**: support@haocai.com
- **技术支持电话**: 400-XXX-XXXX
- **在线帮助**: 系统内帮助中心

---

**文档维护**: 产品团队  
**最后更新**: 2026-01-09
