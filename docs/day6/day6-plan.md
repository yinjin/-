# 第六天工作计划：基础管理模块开发 - 耗材信息管理

## 日期：2026年1月11日

## 总体目标
完成耗材信息管理模块的开发，实现耗材信息的CRUD管理、耗材与分类关联、耗材与供应商关联、耗材图片上传、耗材条码/二维码生成等功能，为后续的入库、出库、库存管理模块奠定基础。

## 详细工作任务

### 1. 后端耗材信息管理模块开发（预计5小时）

#### 1.1 耗材信息实体类设计（预计1小时）
- [ ] 创建耗材信息实体类 `MaterialInfo`
  - 耗材基本信息字段：id、materialCode、materialName、categoryId、specification、unit、unitPrice
  - 耗材关联字段：supplierId、barcode、qrCode
  - 耗材状态字段：status（正常/停用/报废）、createTime、updateTime
  - 耗材描述字段：description、technicalParameters、usageInstructions、storageRequirements
  - 耗材图片字段：imageUrl（支持多张图片，JSON格式存储）
  - 使用Lombok注解简化代码
  - 配置JPA注解和表映射
- [ ] 创建耗材信息DTO类
  - `MaterialInfoCreateDTO`：耗材创建请求
  - `MaterialInfoUpdateDTO`：耗材更新请求
  - `MaterialInfoQueryDTO`：耗材查询请求
  - `MaterialInfoVO`：耗材信息响应
- [ ] 配置实体类验证注解
  - 耗材名称长度验证
  - 耗材编码唯一性验证
  - 单价范围验证
  - 图片URL格式验证
- [ ] 创建MaterialStatus枚举类
  - 定义耗材状态枚举
  - 提供状态转换方法
- [ ] 编译测试通过
- [ ] 创建开发教程文档

#### 1.2 耗材信息数据访问层（预计1小时）
- [ ] 创建耗材信息Mapper接口 `MaterialInfoMapper`
  - 继承BaseMapper获得基础CRUD方法
  - 自定义查询方法：根据分类查询、根据供应商查询、分页查询、模糊搜索
  - 配置MyBatis-Plus注解
- [ ] 创建耗材信息Repository接口 `MaterialInfoRepository`
  - 继承JpaRepository获得JPA方法
  - 自定义查询方法：根据耗材编码查找、根据耗材名称模糊查找
- [ ] 配置数据访问层异常处理
  - 耗材编码重复异常
  - 耗材不存在异常
  - 分类不存在异常
  - 供应商不存在异常
- [ ] 编译测试通过
- [ ] 创建开发教程文档

#### 1.3 耗材信息业务逻辑层（预计2小时）
- [ ] 创建耗材信息Service接口 `IMaterialInfoService`
  - 定义耗材创建、更新、查询、删除等业务方法接口
- [ ] 创建耗材信息Service实现类 `MaterialInfoServiceImpl`
  - 耗材创建逻辑（耗材编码自动生成、分类验证、供应商验证）
  - 耗材更新逻辑（字段验证、唯一性检查）
  - 耗材删除逻辑（检查是否有关联的入库/出库记录）
  - 耗材状态管理逻辑（状态转换、权限检查）
  - 耗材列表查询逻辑（分页、搜索、筛选、排序）
  - 耗材详情查询逻辑（包含分类信息、供应商信息）
  - 耗材编码生成逻辑（分类编码+流水号）
  - 耗材条码/二维码生成逻辑
- [ ] 耗材图片管理
  - 图片上传处理
  - 图片压缩和缩略图生成
  - 图片URL存储（支持多张图片）
  - 图片删除处理
- [ ] 耗材编码生成器
  - 基于分类编码自动生成耗材编码
  - 流水号管理（使用Redis或数据库序列）
  - 编码唯一性验证
- [ ] 耗材条码/二维码生成
  - 使用ZXing库生成条码
  - 使用QRCode库生成二维码
  - 生成结果存储到数据库
- [ ] 编译测试通过
- [ ] 创建开发教程文档

#### 1.4 耗材信息控制层（预计1小时）
- [ ] 创建耗材信息Controller `MaterialInfoController`
  - 耗材创建接口 `POST /api/material`
  - 耗材更新接口 `PUT /api/material/{id}`
  - 耗材删除接口 `DELETE /api/material/{id}`
  - 批量删除接口 `DELETE /api/material/batch`
  - 耗材详情接口 `GET /api/material/{id}`
  - 耗材列表接口 `GET /api/material/list`
  - 耗材分页查询接口 `GET /api/material/page`
  - 耗材状态切换接口 `PUT /api/material/{id}/status`
  - 批量状态更新接口 `PUT /api/material/batch/status`
  - 耗材编码生成接口 `GET /api/material/generate-code`
  - 耗材条码生成接口 `GET /api/material/{id}/barcode`
  - 耗材二维码生成接口 `GET /api/material/{id}/qr-code`
  - 耗材图片上传接口 `POST /api/material/{id}/upload-image`
  - 耗材图片删除接口 `DELETE /api/material/{id}/image/{imageId}`
  - 数据验证接口（耗材编码检查）
- [ ] 配置接口权限注解
  - 耗材查询接口：material:query
  - 耗材创建接口：material:create
  - 耗材更新接口：material:update
  - 耗材删除接口：material:delete
- [ ] 集成Swagger API文档
- [ ] 参数验证和异常处理
- [ ] 编译测试通过

### 2. 文件上传功能开发（预计1.5小时）

#### 2.1 文件上传配置（预计0.5小时）
- [ ] 配置文件上传限制
  - 文件大小限制（10MB）
  - 文件类型限制（jpg、png、jpeg、gif、pdf、doc、docx、xls、xlsx）
  - 文件存储路径配置
- [ ] 创建文件上传配置类 `FileUploadConfig`
  - 配置MultipartResolver
  - 配置文件存储路径
  - 配置文件访问URL
- [ ] 创建文件工具类 `FileUtil`
  - 文件上传方法
  - 文件删除方法
  - 文件重命名方法
  - 文件类型验证方法
  - 文件大小验证方法
- [ ] 编译测试通过
- [ ] 创建开发教程文档

#### 2.2 文件上传接口实现（预计1小时）
- [ ] 创建文件上传Controller `FileController`
  - 单文件上传接口 `POST /api/file/upload`
  - 多文件上传接口 `POST /api/file/upload/batch`
  - 文件下载接口 `GET /api/file/download/{id}`
  - 文件删除接口 `DELETE /api/file/{id}`
  - 文件预览接口 `GET /api/file/preview/{id}`
- [ ] 实现文件上传逻辑
  - 文件类型验证
  - 文件大小验证
  - 文件病毒扫描（可选）
  - 文件存储（本地/OSS）
  - 文件信息记录到数据库
- [ ] 实现图片处理逻辑
  - 图片压缩
  - 缩略图生成
  - 图片格式转换
- [ ] 配置接口权限注解
  - 文件上传接口：file:upload
  - 文件下载接口：file:download
  - 文件删除接口：file:delete
- [ ] 集成Swagger API文档
- [ ] 编译测试通过
- [ ] 创建开发教程文档

### 3. 数据库表结构完善（预计1小时）

#### 3.1 耗材信息表结构
- [ ] 检查并完善耗材信息表 `material_info`
  - 确认所有字段定义正确
  - 检查索引配置（material_code、category_id、supplier_id、status）
  - 验证外键约束（category_id、supplier_id）
- [ ] 添加耗材图片表 `material_image`
  - 图片ID、耗材ID、图片URL、图片类型、排序、创建时间
- [ ] 执行数据库脚本更新
  - 更新init.sql脚本
  - 执行数据库迁移
- [ ] 创建开发文档

### 4. 前端耗材信息管理页面开发（预计3小时）

#### 4.1 耗材信息列表页面（预计1.5小时）
- [ ] 创建耗材信息列表页面 `MaterialList.vue`
  - 耗材信息表格（支持分页、排序）
  - 高级搜索功能（按耗材名称、编码、分类、供应商、状态搜索）
  - 新增耗材按钮
  - 批量操作按钮（批量删除、批量导出、批量状态更新）
  - 耗材状态标签显示
  - 耗材图片预览
  - 耗材条码/二维码显示
- [ ] 配置耗材信息列表路由
  - 添加到路由配置中
  - 配置页面权限（material:query）
- [ ] 实现耗材信息列表API调用
  - 获取耗材列表
  - 搜索耗材
  - 分页加载
  - 排序功能
- [ ] 创建开发文档

#### 4.2 耗材信息表单页面（预计1小时）
- [ ] 创建耗材信息表单组件 `MaterialForm.vue`
  - 耗材基本信息表单（耗材名称、规格型号、单位、单价）
  - 耗材分类选择（树形下拉框）
  - 耗材供应商选择（下拉搜索框）
  - 耗材描述表单（描述、技术参数、使用说明、存储要求）
  - 耗材图片上传（支持多张图片、拖拽上传、图片预览）
  - 耗材状态选择
  - 表单验证（必填项、格式验证、唯一性验证）
- [ ] 实现耗材信息表单API调用
  - 创建耗材
  - 更新耗材
  - 耗材编码自动生成
  - 耗材条码/二维码生成
- [ ] 创建开发文档

#### 4.3 耗材信息详情页面（预计0.5小时）
- [ ] 创建耗材信息详情页面 `MaterialDetail.vue`
  - 耗材基本信息展示
  - 耗材分类信息展示
  - 耗材供应商信息展示
  - 耗材图片展示（轮播图）
  - 耗材条码/二维码展示
  - 耗材操作历史（入库记录、出库记录）
  - 编辑耗材按钮
  - 删除耗材按钮
- [ ] 配置耗材信息详情路由
  - 添加到路由配置中
  - 配置页面权限（material:query）
- [ ] 实现耗材信息详情API调用
  - 获取耗材详情
  - 获取耗材操作历史
- [ ] 创建开发文档

### 5. 功能测试和联调（预计1.5小时）

#### 5.1 后端接口测试
- [ ] 创建测试类MaterialInfoControllerTest
- [ ] 编写测试用例
  - [ ] 耗材创建接口测试（正常创建、编码重复、分类不存在、供应商不存在）
  - [ ] 耗材更新接口测试（正常更新、耗材不存在、编码重复）
  - [ ] 耗材删除接口测试（正常删除、耗材不存在、有关联记录）
  - [ ] 耗材查询接口测试（列表查询、分页查询、搜索查询、详情查询）
  - [ ] 耗材状态管理接口测试（状态切换、批量状态更新）
  - [ ] 耗材编码生成接口测试（正常生成、重复生成）
  - [ ] 耗材条码/二维码生成接口测试（正常生成、耗材不存在）
  - [ ] 文件上传接口测试（正常上传、文件类型错误、文件大小超限）
  - [ ] 边界条件测试（空值、超长字符串、特殊字符）
  - [ ] 性能测试（大数据量查询、并发操作）
- [ ] 执行测试并验证结果
- [ ] 生成测试覆盖率报告
- [ ] 创建开发记录文档

#### 5.2 前端功能测试
- [ ] 耗材信息列表页面功能测试
- [ ] 耗材信息表单页面功能测试
- [ ] 耗材信息详情页面功能测试
- [ ] 文件上传功能测试
- [ ] 图片预览功能测试
- [ ] 条码/二维码生成功能测试

#### 5.3 前后端联调测试
- [ ] 耗材信息CRUD完整流程测试
- [ ] 耗材搜索和筛选功能测试
- [ ] 耗材图片上传和预览测试
- [ ] 耗材条码/二维码生成和显示测试
- [ ] 权限验证测试
- [ ] 异常处理测试

## 验收标准
- [ ] 耗材信息能正常创建、更新、删除
- [ ] 耗材编码能自动生成且唯一
- [ ] 耗材能正确关联分类和供应商
- [ ] 耗材图片能正常上传、预览、删除
- [ ] 耗材条码/二维码能正常生成和显示
- [ ] 耗材列表能正常分页、搜索、排序
- [ ] 耗束能按分类、供应商、状态筛选
- [ ] 所有接口都有相应权限控制
- [ ] 前后端联调测试通过
- [ ] 测试覆盖率 > 80%

## 技术要点
- 耗材编码自动生成（分类编码+流水号）
- 条码/二维码生成（ZXing、QRCode）
- 文件上传和图片处理
- 多图片存储和管理
- MyBatis-Plus数据访问
- Vue 3 Composition API
- Element Plus组件库
- TypeScript类型安全
- 图片压缩和缩略图生成
- 文件类型和大小验证

## 注意事项
- 耗材编码必须唯一且自动生成
- 耗材删除前需要检查是否有关联的入库/出库记录
- 耗材图片需要压缩和生成缩略图
- 文件上传需要验证文件类型和大小
- 耗材条码/二维码生成后需要存储到数据库
- 耗材分类和供应商必须存在才能关联
- 前端需要处理图片上传的进度和错误
- 数据库字段长度要合理设置
- 接口要做好参数验证和错误处理

## 预计完成时间
18:00 - 耗材信息管理模块开发完成并测试通过

## 风险评估
- 耗材编码生成逻辑复杂，可能出现重复
- 文件上传功能可能存在安全隐患
- 图片处理可能影响性能
- 耗材删除逻辑复杂，需要充分测试
- 前端图片上传可能影响用户体验

## 依赖检查
- 确保耗材分类管理模块已完成
- 确保供应商管理模块已完成（或至少有基础数据）
- 确保文件上传相关依赖正确配置
- 确保条码/二维码生成库版本兼容
- 确保前端图片上传组件配置正确
- 确保数据库表结构与实体类匹配

## 开发流程规范

### 一、开发模式与流程
1. **采用持续集成（CI）开发模式**，确保代码持续集成、自动化构建与测试。
2. **功能驱动开发**：每个功能模块开发完成后，必须经过充分测试与验证，确保无误后方可进入下一功能开发。
3. **迭代推进**：以功能为单位进行迭代，保证每个模块稳定可用。

### 二、测试策略
1. **本地测试优先**：
   - 所有功能需在本地进行完整测试，包括单元测试、集成测试及界面交互测试。
   - 需使用与CI环境一致的测试工具和依赖版本。
2. **自动化测试**：
   - 针对关键路径与核心功能编写自动化测试脚本。
   - 每次提交前应在本地运行自动化测试套件。
3. **推送前验证**：
   - 确保本地测试全部通过后，才可将代码推送至GitHub。
4. **部署测试**：
   - 代码推送后触发CI流程，执行部署与线上环境测试，确保功能在目标环境中正常运行。

### 三、版本控制与部署
1. **分支管理**：采用功能分支策略，每个新功能在独立分支开发，通过Pull Request合并至主分支。
2. **CI/CD流水线**：
   - 利用GitHub Actions等工具实现自动化测试与部署。
   - 部署成功后需在测试环境进行验证。
3. **回滚机制**：确保发现严重问题时能快速回退至上一稳定版本。

### 四、过程记录与文档
1. **开发记录**：每个功能需记录：
   - 实现思路、关键代码变更、依赖调整。
   - 开发过程中遇到的问题与解决方案。
2. **测试记录**：
   - 测试工具、框架及版本。
   - 测试方法、用例设计、测试数据。
   - 测试结果（通过/失败）、截图或日志摘要。
   - 发现的缺陷及其修复状态。
3. **文档更新**：
   - 同步更新技术文档、API文档及用户手册。
   - 记录配置变更、环境依赖及部署步骤。

### 五、质量与协作要求
1. **代码审查**：所有合并请求需经过至少一名成员审查。
2. **持续反馈**：定期同步开发与测试进展，及时调整计划。
3. **责任到人**：每个功能由开发者主导测试并确保质量，测试记录归档至项目Wiki或指定文档库。

通过以上规范，旨在形成**开发→测试→记录→集成**的闭环流程，确保交付质量，并为后续维护、BUG修复与优化提供完整依据。
