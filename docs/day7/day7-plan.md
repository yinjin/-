# 第七天工作计划：基础管理模块开发 - 供应商管理

## 日期：2026年1月12日

## 总体目标
完成供应商管理模块的开发，实现供应商信息的CRUD管理、供应商资质管理、供应商评价体系、供应商与耗材关联等功能，为后续的入库管理模块奠定基础。

## 详细工作任务

### 1. 后端供应商管理模块开发（预计4小时）

#### 1.1 供应商实体类设计（预计1小时）
- [x] 创建供应商信息实体类 `SupplierInfo`
  - 供应商基本信息字段：id、supplierCode、supplierName、contactPerson、phone、email、address
  - 供应商资质字段：businessLicense、taxNumber、bankAccount、bankName
  - 供应商评价字段：creditRating（信用等级1-5）、cooperationStatus（合作状态）
  - 供应商状态字段：status（正常/禁用）、createTime、updateTime
  - 供应商描述字段：description
  - 使用Lombok注解简化代码
  - 配置MyBatis-Plus注解和表映射
- [x] 创建供应商DTO类
  - `SupplierCreateDTO`：供应商创建请求
  - `SupplierUpdateDTO`：供应商更新请求
  - `SupplierQueryDTO`：供应商查询请求
  - `SupplierVO`：供应商信息响应
- [x] 配置实体类验证注解
  - 供应商名称长度验证
  - 供应商编码唯一性验证
  - 联系人信息格式验证
  - 银行账号格式验证
  - 税号格式验证
- [x] 创建CooperationStatus枚举类
  - 定义合作状态枚举（合作中、已终止）
  - 使用@EnumValue注解标记数据库存储值
- [x] 编译测试通过
- [x] 数据库表创建完成
- [x] 文档同步完成（init.sql、database-design.md）

#### 1.2 供应商数据访问层（预计1小时）
- [x] 创建供应商Mapper接口 `SupplierInfoMapper`
  - 继承BaseMapper获得基础CRUD方法
  - 自定义查询方法：根据信用等级查询、根据合作状态查询、分页查询、模糊搜索
  - 配置MyBatis-Plus注解
- [x] 创建供应商Repository实现类 `SupplierInfoRepository`
  - 封装数据访问逻辑（使用MyBatis-Plus，不使用Spring Data JPA）
  - 自定义查询方法：根据供应商编码查找、根据供应商名称模糊查找
- [x] 配置数据访问层异常处理
  - 供应商编码重复异常
  - 供应商不存在异常
  - 供应商有关联耗材异常
- [x] 编译测试通过
- [x] 创建开发教程文档 `docs/common/supplier-data-access-layer-tutorial.md`

#### 1.3 供应商业务逻辑层（预计1.5小时）
- [ ] 创建供应商Service接口 `ISupplierInfoService`
  - 定义供应商创建、更新、查询、删除等业务方法接口
- [ ] 创建供应商Service实现类 `SupplierInfoServiceImpl`
  - 供应商创建逻辑（供应商编码自动生成、信息验证）
  - 供应商更新逻辑（字段验证、唯一性检查）
  - 供应商删除逻辑（检查是否有关联的耗材、入库记录）
  - 供应商状态管理逻辑（状态转换、权限检查）
  - 供应商列表查询逻辑（分页、搜索、筛选、排序）
  - 供应商详情查询逻辑（包含关联的耗材信息、入库记录）
  - 供应商编码生成逻辑（SUP+年月日+流水号）
  - 供应商信用等级管理逻辑
  - 供应商合作状态管理逻辑
- [ ] 供应商资质管理
  - 营业执照上传和管理
  - 资质文件存储
  - 资质到期提醒
- [ ] 供应商评价体系
  - 供应商评价记录
  - 信用等级计算
  - 评价历史查询
- [ ] 编译测试通过
- [ ] 创建开发教程文档

#### 1.4 供应商控制层（预计0.5小时）
- [x] 创建供应商Controller `SupplierInfoController`
  - [x] 供应商创建接口 `POST /api/supplier`
  - [x] 供应商更新接口 `PUT /api/supplier/{id}`
  - [x] 供应商删除接口 `DELETE /api/supplier/{id}`
  - [x] 批量删除接口 `DELETE /api/supplier/batch`
  - [x] 供应商详情接口 `GET /api/supplier/{id}`
  - [x] 供应商列表接口 `GET /api/supplier/list`
  - [x] 供应商分页查询接口 `GET /api/supplier/page`
  - [x] 供应商状态切换接口 `PUT /api/supplier/{id}/status`
  - [x] 批量状态更新接口 `PUT /api/supplier/batch/status`
  - [x] 供应商编码生成接口 `GET /api/supplier/generate-code`
  - [x] 供应商评价接口 `POST /api/supplier/{id}/evaluate`
  - [x] 供应商评价历史接口 `GET /api/supplier/{id}/evaluations`
  - [x] 供应商评价查询接口 `GET /api/supplier/{id}/my-evaluations`
  - [ ] 供应商资质上传接口 `POST /api/supplier/{id}/upload-qualification`（待开发）
  - [x] 数据验证接口（供应商编码检查）
- [x] 配置接口权限注解
  - [x] 供应商查询接口：supplier:query
  - [x] 供应商创建接口：supplier:create
  - [x] 供应商更新接口：supplier:update
  - [x] 供应商删除接口：supplier:delete
  - [x] 供应商评价接口：supplier:evaluate
- [x] 集成Swagger API文档
- [x] 参数验证和异常处理
- [x] 编译测试通过
- [x] 创建开发报告文档 `supplier-controller-layer-development-report.md`

### 2. 供应商评价体系开发（预计1.5小时）

#### 2.1 供应商评价实体类设计（预计0.5小时）
- [x] 创建供应商评价实体类 `SupplierEvaluation`
  - 评价基本信息字段：id、supplierId、evaluatorId、evaluationDate
  - 评价内容字段：deliveryScore（交付评分）、qualityScore（质量评分）、serviceScore（服务评分）、priceScore（价格评分）
  - 评价结果字段：totalScore（总分）、averageScore（平均分）、creditRating（信用等级）
  - 评价备注字段：remark
  - 评价时间字段：createTime、updateTime
  - 使用Lombok注解简化代码
  - 配置MyBatis-Plus注解和表映射
- [x] 创建供应商评价DTO类
  - `SupplierEvaluationCreateDTO`：评价创建请求
  - `SupplierEvaluationVO`：评价信息响应
- [x] 配置实体类验证注解
  - 评分范围验证（1-10分）
  - 评价内容长度验证
- [x] 编译测试通过
- [x] 创建开发教程文档 `docs/day7/supplier-evaluation-development-report.md`

#### 2.2 供应商评价业务逻辑（预计1小时）
- [x] 创建供应商评价Service接口 `ISupplierEvaluationService`
  - 定义评价创建、查询等业务方法接口
- [x] 创建供应商评价Service实现类 `SupplierEvaluationServiceImpl`
  - 评价创建逻辑（评分验证、总分计算、平均分计算、信用等级计算）
  - 评价查询逻辑（按供应商查询、按评价人查询）
  - 评价统计逻辑（供应商平均评分、评价次数）
  - 供应商信用等级更新逻辑（基于评价历史）
- [x] 信用等级计算规则
  - 平均分9.0-10.0：信用等级10（优秀）
  - 平均分8.0-8.9：信用等级9（良好）
  - 平均分7.0-7.9：信用等级8（较好）
  - 平均分6.0-6.9：信用等级7（一般）
  - 平均分5.0-5.9：信用等级6（及格）
  - 平均分4.0-4.9：信用等级5（较差）
  - 平均分3.0-3.9：信用等级4（差）
  - 平均分2.0-2.9：信用等级3（很差）
  - 平均分1.0-1.9：信用等级2（极差）
  - 平均分0.0-0.9：信用等级1（不合格）
- [x] 编译测试通过
- [x] 创建开发教程文档 `docs/day7/supplier-evaluation-development-report.md`

### 3. 数据库表结构完善（预计1小时）

#### 3.1 供应商相关表结构
- [ ] 检查并完善供应商信息表 `supplier_info`
  - 确认所有字段定义正确
  - 检查索引配置（supplier_code、supplier_name、credit_rating、cooperation_status）
  - 验证外键约束
- [ ] 添加供应商评价表 `supplier_evaluation`
  - 评价ID、供应商ID、评价人ID、评价日期、各项评分、总分、平均分、信用等级、备注、创建时间
  - 配置索引（supplier_id、evaluator_id、evaluation_date）
  - 配置外键约束（supplier_id、evaluator_id）
- [ ] 添加供应商资质表 `supplier_qualification`
  - 资质ID、供应商ID、资质类型、资质文件URL、到期日期、创建时间
  - 配置索引（supplier_id、expiry_date）
  - 配置外键约束（supplier_id）
- [ ] 执行数据库脚本更新
  - 更新init.sql脚本
  - 执行数据库迁移
- [ ] 创建开发文档

### 4. 前端供应商管理页面开发（预计3小时）

#### 4.1 供应商列表页面（预计1.5小时）
- [ ] 创建供应商列表页面 `SupplierList.vue`
  - 供应商信息表格（支持分页、排序）
  - 高级搜索功能（按供应商名称、编码、联系人、信用等级、合作状态搜索）
  - 新增供应商按钮
  - 批量操作按钮（批量删除、批量导出、批量状态更新）
  - 供应商状态标签显示
  - 信用等级星级显示
  - 合作状态标签显示
- [ ] 配置供应商列表路由
  - 添加到路由配置中
  - 配置页面权限（supplier:query）
- [ ] 实现供应商列表API调用
  - 获取供应商列表
  - 搜索供应商
  - 分页加载
  - 排序功能
- [ ] 创建开发文档

#### 4.2 供应商表单页面（预计1小时）
- [x] 创建供应商表单组件 `SupplierForm.vue`
  - 供应商基本信息表单（供应商名称、联系人、电话、邮箱、地址）
  - 供应商资质表单（营业执照、税号、银行账号、开户行）
  - 供应商描述表单
  - 供应商状态选择
  - 供应商资质文件上传
  - 表单验证（必填项、格式验证、唯一性验证）
- [x] 实现供应商表单API调用
  - 创建供应商
  - 更新供应商
  - 供应商编码自动生成
  - 资质文件上传
- [x] 创建开发文档（supplier-form-development-report.md）

#### 4.3 供应商详情和评价页面（预计0.5小时）
- [x] 创建供应商详情页面 `SupplierDetail.vue`
  - 供应商基本信息展示
  - 供应商资质信息展示
  - 供应商信用等级展示（星级）
  - 供应商评价历史（时间轴展示）
  - 供应商关联的耗材列表
  - 供应商入库记录统计
  - 编辑供应商按钮
  - 删除供应商按钮
  - 评价供应商按钮
- [x] 创建供应商评价组件 `SupplierEvaluationForm.vue`
  - 评价表单（交付评分、质量评分、服务评分、价格评分）
  - 评价备注
  - 评分滑块
  - 表单验证
- [x] 配置供应商详情路由
  - 添加到路由配置中
  - 配置页面权限（supplier:query、supplier:evaluate）
- [x] 实现供应商详情API调用
  - 获取供应商详情
  - 获取供应商评价历史
  - 提交供应商评价
- [x] 创建开发文档（supplier-detail-development-report.md）

### 5. 功能测试和联调（预计1.5小时）

#### 5.1 后端接口测试
- [x] 创建测试类SupplierInfoControllerTest
- [x] 创建测试类SupplierEvaluationServiceTest
- [x] 编写测试用例
- [ ] 供应商创建接口测试（正常创建、编码重复、信息不完整）
- [ ] 供应商更新接口测试（正常更新、供应商不存在、编码重复）
- [ ] 供应商删除接口测试（正常删除、供应商不存在、有关联耗材）
- [ ] 供应商查询接口测试（列表查询、分页查询、搜索查询、详情查询）
- [ ] 供应商状态管理接口测试（状态切换、批量状态更新）
- [ ] 供应商编码生成接口测试（正常生成、重复生成）
- [ ] 供应商评价接口测试（正常评价、评分范围错误、供应商不存在）
- [ ] 信用等级计算测试（各种评分场景）
- [ ] 供应商资质上传测试（正常上传、文件类型错误）
- [ ] 边界条件测试（空值、超长字符串、特殊字符）
- [ ] 性能测试（大数据量查询、并发操作）
- [ ] 执行测试并验证结果
- [ ] 生成测试覆盖率报告
- [ ] 创建开发记录文档

#### 5.2 前端功能测试
- [ ] 供应商列表页面功能测试
- [ ] 供应商表单页面功能测试
- [ ] 供应商详情页面功能测试
- [ ] 供应商评价功能测试
- [ ] 供应商资质上传功能测试
- [ ] 信用等级显示测试

#### 5.3 前后端联调测试
- [ ] 供应商信息CRUD完整流程测试
- [ ] 供应商搜索和筛选功能测试
- [ ] 供应商评价流程测试
- [ ] 信用等级计算准确性测试
- [ ] 供应商资质上传和预览测试
- [ ] 权限验证测试
- [ ] 异常处理测试

## 验收标准
- [ ] 供应商信息能正常创建、更新、删除
- [ ] 供应商编码能自动生成且唯一
- [ ] 供应商资质能正常上传和管理
- [ ] 供应商评价功能完整
- [ ] 信用等级计算准确
- [ ] 供应商列表能正常分页、搜索、排序
- [ ] 供应商能按信用等级、合作状态筛选
- [ ] 所有接口都有相应权限控制
- [ ] 前后端联调测试通过
- [ ] 测试覆盖率 > 80%

## 技术要点
- 供应商编码自动生成（SUP+年月日+流水号）
- 供应商评价体系（多维度评分）
- 信用等级计算算法
- 供应商资质管理
- MyBatis-Plus数据访问
- Vue 3 Composition API
- Element Plus组件库
- TypeScript类型安全
- 评分滑块组件
- 星级评分显示

## 注意事项
- 供应商编码必须唯一且自动生成
- 供应商删除前需要检查是否有关联的耗材或入库记录
- 供应商评价需要验证评分范围（1-10分）
- 信用等级计算需要基于所有评价历史
- 供应商资质文件需要验证文件类型和大小
- 供应商合作状态变更需要记录原因
- 前端需要处理评价表单的交互和验证
- 数据库字段长度要合理设置
- 接口要做好参数验证和错误处理

## 预计完成时间
18:00 - 供应商管理模块开发完成并测试通过

## 风险评估
- 供应商编码生成逻辑复杂，可能出现重复
- 信用等级计算算法需要充分测试
- 供应商评价体系可能需要调整
- 供应商删除逻辑复杂，需要充分测试
- 供应商资质管理可能涉及文件存储

## 依赖检查
- 确保文件上传功能已完成
- 确保用户管理模块已完成（评价人信息）
- 确保文件上传相关依赖正确配置
- 确保前端评分组件配置正确
- 确保数据库表结构与实体类匹配

## 开发流程规范

### 一、开发模式与流程
1. **采用持续集成（CI）开发模式**，确保代码持续集成、自动化构建与测试。
2. **功能驱动开发**：每个功能模块开发完成后，必须经过充分测试与验证，确保无误后方可进入下一功能开发。
3. **迭代推进**：以功能为单位进行迭代，保证每个模块稳定可用。

### 二、测试策略
1. **本地测试优先**：
   - 所有功能需在本地进行完整测试，包括单元测试、集成测试及界面交互测试。
   - 需使用与CI环境一致的测试工具和依赖版本。
2. **自动化测试**：
   - 针对关键路径与核心功能编写自动化测试脚本。
   - 每次提交前应在本地运行自动化测试套件。
3. **推送前验证**：
   - 确保本地测试全部通过后，才可将代码推送至GitHub。
4. **部署测试**：
   - 代码推送后触发CI流程，执行部署与线上环境测试，确保功能在目标环境中正常运行。

### 三、版本控制与部署
1. **分支管理**：采用功能分支策略，每个新功能在独立分支开发，通过Pull Request合并至主分支。
2. **CI/CD流水线**：
   - 利用GitHub Actions等工具实现自动化测试与部署。
   - 部署成功后需在测试环境进行验证。
3. **回滚机制**：确保发现严重问题时能快速回退至上一稳定版本。

### 四、过程记录与文档
1. **开发记录**：每个功能需记录：
   - 实现思路、关键代码变更、依赖调整。
   - 开发过程中遇到的问题与解决方案。
2. **测试记录**：
   - 测试工具、框架及版本。
   - 测试方法、用例设计、测试数据。
   - 测试结果（通过/失败）、截图或日志摘要。
   - 发现的缺陷及其修复状态。
3. **文档更新**：
   - 同步更新技术文档、API文档及用户手册。
   - 记录配置变更、环境依赖及部署步骤。

### 五、质量与协作要求
1. **代码审查**：所有合并请求需经过至少一名成员审查。
2. **持续反馈**：定期同步开发与测试进展，及时调整计划。
3. **责任到人**：每个功能由开发者主导测试并确保质量，测试记录归档至项目Wiki或指定文档库。

通过以上规范，旨在形成**开发→测试→记录→集成**的闭环流程，确保交付质量，并为后续维护、BUG修复与优化提供完整依据。
