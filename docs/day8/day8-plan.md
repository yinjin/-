# 第八天工作计划：基础管理模块开发 - 库存管理基础功能

## 日期：2026年1月13日

## 总体目标
完成库存管理基础功能的开发，实现库存信息的查询、库存预警、库存更新等核心功能，为后续入库、出库、盘点等模块奠定基础。

## 详细工作任务

### 1. 后端库存管理模块开发（预计5小时）

#### 1.1 库存实体类设计（预计1小时）
- [ ] 创建库存实体类 `MaterialInventory`
  - 库存基本信息字段：id、materialId、quantity、availableQuantity ✅
  - 库存阈值字段：safeQuantity、maxQuantity ✅
  - 库存位置字段：warehouse、location ✅
  - 库存时间字段：lastInTime、lastOutTime ✅
  - 库存统计字段：totalInQuantity、totalOutQuantity ✅
  - 使用Lombok注解简化代码 ✅
  - 配置MyBatis-Plus注解和表映射 ✅
- [ ] 创建库存DTO类
  - `InventoryQueryDTO`：库存查询请求 ✅
  - `InventoryUpdateDTO`：库存更新请求 ✅
  - `InventoryAdjustDTO`：库存调整请求 ✅
  - `InventoryVO`：库存信息响应 ✅
  - `InventoryWarningVO`：库存预警响应 ✅
- [ ] 配置实体类验证注解
  - 数量非负验证 ✅
  - 阈值范围验证 ✅
- [ ] 创建InventoryStatus枚举类
  - 定义库存状态枚举（正常、预警、超储）✅
  - 提供状态判断方法 ✅
- [ ] 编译测试通过 ✅
- [ ] 创建开发教程文档

#### 1.2 库存数据访问层（预计1小时）
- [ ] 创建库存Mapper接口 `MaterialInventoryMapper`
  - 继承BaseMapper获得基础CRUD方法 ✅
  - 自定义查询方法：根据耗材ID查询、根据仓库查询、分页查询 ✅
  - 库存预警查询方法：低库存查询、超储查询、临期查询 ✅
  - 库存统计查询方法：库存总价值、库存周转率 ✅
  - 配置MyBatis-Plus注解 ✅
- [ ] 创建库存XML映射文件
  - 配置复杂SQL查询 ✅
  - 配置库存预警查询 ✅
  - 配置库存统计查询 ✅
- [ ] 配置数据访问层异常处理
  - 库存不存在异常 ✅
  - 库存不足异常 ✅
  - 库存超储异常 ✅
- [ ] 编译测试通过 ✅
- [ ] 创建开发教程文档

#### 1.3 库存业务逻辑层（预计2小时）
- [ ] 创建库存Service接口 `IMaterialInventoryService`
  - 定义库存查询、更新、调整、预警等业务方法接口 ✅
- [ ] 创建库存Service实现类 `MaterialInventoryServiceImpl`
  - 库存查询逻辑（根据耗材ID、仓库、状态查询）✅
  - 库存更新逻辑（入库、出库时更新库存）✅
  - 库存调整逻辑（手动调整库存数量）✅
  - 库存预警逻辑（低库存、超储、临期预警）✅
  - 库存统计逻辑（库存总价值、库存周转率）✅
  - 库存初始化逻辑（新增耗材时自动创建库存记录）✅
- [ ] 库存预警机制
  - 低库存预警（availableQuantity < safeQuantity）✅
  - 超储预警（quantity > maxQuantity）✅
  - 临期预警（耗材保质期临近）✅
  - 预警通知机制（系统消息、邮件）✅
- [ ] 库存事务控制
  - 入库事务（增加库存、更新入库时间）✅
  - 出库事务（减少库存、更新出库时间、检查库存充足）✅
  - 调整事务（记录调整原因、更新库存）✅
- [ ] 库存缓存优化
  - Redis缓存库存信息 ✅
  - 缓存更新策略（写时更新）✅
  - 缓存过期时间设置 ✅
- [ ] 编译测试通过 ✅
- [ ] 创建开发教程文档

#### 1.4 库存控制层（预计1小时）
- [ ] 创建库存Controller `MaterialInventoryController`
  - 库存查询接口 `/api/inventory/list` ✅
  - 库存详情接口 `/api/inventory/{id}` ✅
  - 库存预警接口 `/api/inventory/warning` ✅
  - 低库存列表接口 `/api/inventory/low-stock` ✅
  - 超储列表接口 `/api/inventory/over-stock` ✅
  - 临期列表接口 `/api/inventory/expired` ✅
  - 库存调整接口 `/api/inventory/adjust` ✅
  - 库存统计接口 `/api/inventory/statistics` ✅
  - 库存周转率接口 `/api/inventory/turnover` ✅
  - 库存价值接口 `/api/inventory/value` ✅
- [ ] 统一响应格式封装
  - 使用ApiResponse<T>包装返回 ✅
  - 统一JSON格式：{code, message, data, timestamp} ✅
- [ ] 配置接口权限注解
  - 库存查询权限：inventory:query ✅
  - 库存调整权限：inventory:adjust ✅
  - 库存统计权限：inventory:statistics ✅
- [ ] 集成Swagger API文档 ✅
- [ ] 参数验证和异常处理 ✅
- [ ] 编译测试通过 ✅

### 2. 数据库表结构完善（预计1小时）

#### 2.1 库存相关表结构
- [ ] 检查并完善库存表 `material_inventory`
  - 确认所有字段定义正确 ✅
  - 检查索引配置（material_id、warehouse、available_quantity）✅
  - 验证外键约束（material_id关联material_info）✅
- [ ] 添加库存预警表 `inventory_warning`
  - 预警ID、耗材ID、预警类型、预警值、预警时间、处理状态 ✅
- [ ] 添加库存调整记录表 `inventory_adjust_record`
  - 调整ID、耗材ID、调整前数量、调整后数量、调整原因、调整人、调整时间 ✅
- [ ] 执行数据库脚本更新
  - 更新init.sql脚本 ✅
  - 执行数据库迁移 ✅
- [ ] 创建开发文档

### 3. 前端库存管理页面开发（预计3小时）

#### 3.1 库存列表页面开发（预计1.5小时）
- [ ] 创建库存列表页面 `InventoryList.vue`
  - 库存表格展示（支持分页）✅
  - 搜索功能（按耗材名称、分类、仓库、状态搜索）✅
  - 筛选功能（按库存状态、预警类型筛选）✅
  - 库存详情查看弹窗 ✅
  - 库存调整弹窗 ✅
- [ ] 配置库存列表路由
  - 添加到路由配置中 ✅
  - 配置页面权限 ✅
- [ ] 实现库存列表API调用
  - 获取库存列表 ✅
  - 获取库存详情 ✅
  - 库存调整 ✅
  - 库存搜索和筛选 ✅

#### 3.2 库存预警页面开发（预计1小时）
- [ ] 创建库存预警页面 `InventoryWarning.vue`
  - 预警列表表格（支持分页）✅
  - 预警类型筛选（低库存、超储、临期）✅
  - 预警处理功能（标记已处理）✅
  - 预警统计卡片（预警总数、未处理数）✅
- [ ] 配置库存预警路由
  - 添加到路由配置中 ✅
  - 配置页面权限 ✅
- [ ] 实现库存预警API调用
  - 获取预警列表 ✅
  - 获取预警统计 ✅
  - 处理预警 ✅

#### 3.3 库存统计页面开发（预计0.5小时）
- [ ] 创建库存统计页面 `InventoryStatistics.vue`
  - 库存总价值卡片 ✅
  - 库存周转率图表 ✅
  - 库存分类占比饼图 ✅
  - 库存预警统计柱状图 ✅
- [ ] 配置库存统计路由
  - 添加到路由配置中 ✅
  - 配置页面权限 ✅
- [ ] 实现库存统计API调用
  - 获取库存价值 ✅
  - 获取库存周转率 ✅
  - 获取库存分类占比 ✅
  - 获取库存预警统计 ✅

### 4. 功能测试和联调（预计1.5小时）

#### 4.1 后端接口测试
- [ ] 创建测试类MaterialInventoryControllerTest
- [ ] 创建测试环境配置application-test.yml
- [ ] 配置H2内存数据库
- [ ] 编写测试用例
  - [ ] 库存查询接口测试（5个测试用例）
  - [ ] 库存预警接口测试（4个测试用例）
  - [ ] 库存调整接口测试（3个测试用例）
  - [ ] 库存统计接口测试（3个测试用例）
  - [ ] 边界条件测试（4个测试用例）
  - [ ] 异常处理测试（3个测试用例）
- [ ] 执行测试并验证结果
- [ ] 生成测试覆盖率报告
- [ ] 集成到CI/CD流程
- [ ] 创建开发记录文档

#### 4.2 前端功能测试
- [ ] 库存列表页面功能测试
- [ ] 库存预警页面功能测试
- [ ] 库存统计页面功能测试
- [ ] 权限验证测试

#### 4.3 前后端联调测试
- [ ] 库存查询流程完整测试
- [ ] 库存调整流程测试
- [ ] 库存预警流程测试
- [ ] 库存统计流程测试
- [ ] 异常处理测试

## 验收标准
- [ ] 库存信息能正常查询和展示
- [ ] 库存预警能正常触发和显示
- [ ] 库存调整功能正常工作
- [ ] 库存统计数据准确
- [ ] 库存缓存机制有效
- [ ] 所有接口都有相应权限控制
- [ ] 前后端联调测试通过
- [ ] 测试覆盖率 > 80%

## 技术要点
- 库存预警机制（低库存、超储、临期）
- 库存事务控制（入库、出库、调整）
- 库存缓存优化（Redis缓存）
- 库存统计计算（库存价值、周转率）
- MyBatis-Plus复杂查询
- Vue 3 Composition API
- Element Plus组件库
- ECharts图表展示
- TypeScript类型安全

## 注意事项
- 库存数量必须非负
- 出库时必须检查库存是否充足
- 库存调整必须记录调整原因
- 库存预警要及时通知相关人员
- 库存缓存要及时更新
- 库存统计要考虑性能优化
- 数据库字段长度要合理设置
- 接口要做好参数验证和错误处理

## 预计完成时间
18:00 - 库存管理基础功能开发完成并测试通过

## 风险评估
- 库存并发更新可能导致数据不一致
- 库存预警机制可能影响系统性能
- 库存缓存策略不当可能导致数据不准确
- 库存统计查询可能存在性能瓶颈
- 数据库设计不合理影响后续扩展

## 依赖检查
- 确保MyBatis-Plus依赖正确配置
- 确保Redis依赖正确配置
- 确保前端ECharts依赖正确配置
- 确保数据库表结构与实体类匹配
- 确保耗材信息管理模块已完成
- 确保权限控制模块已完成

## 开发流程规范

### 一、开发模式与流程
1. **采用持续集成（CI）开发模式**，确保代码持续集成、自动化构建与测试。
2. **功能驱动开发**：每个功能模块开发完成后，必须经过充分测试与验证，确保无误后方可进入下一功能开发。
3. **迭代推进**：以功能为单位进行迭代，保证每个模块稳定可用。

### 二、测试策略
1. **本地测试优先**：
   - 所有功能需在本地进行完整测试，包括单元测试、集成测试及界面交互测试。
   - 需使用与CI环境一致的测试工具和依赖版本。
2. **自动化测试**：
   - 针对关键路径与核心功能编写自动化测试脚本。
   - 每次提交前应在本地运行自动化测试套件。
3. **推送前验证**：
   - 确保本地测试全部通过后，才可将代码推送至GitHub。
4. **部署测试**：
   - 代码推送后触发CI流程，执行部署与线上环境测试，确保功能在目标环境中正常运行。

### 三、版本控制与部署
1. **分支管理**：采用功能分支策略，每个新功能在独立分支开发，通过Pull Request合并至主分支。
2. **CI/CD流水线**：
   - 利用GitHub Actions等工具实现自动化测试与部署。
   - 部署成功后需在测试环境进行验证。
3. **回滚机制**：确保发现严重问题时能快速回退至上一稳定版本。

### 四、过程记录与文档
1. **开发记录**：每个功能需记录：
   - 实现思路、关键代码变更、依赖调整。
   - 开发过程中遇到的问题与解决方案。
2. **测试记录**：
   - 测试工具、框架及版本。
   - 测试方法、用例设计、测试数据。
   - 测试结果（通过/失败）、截图或日志摘要。
   - 发现的缺陷及其修复状态。
3. **文档更新**：
   - 同步更新技术文档、API文档及用户手册。
   - 记录配置变更、环境依赖及部署步骤。

### 五、质量与协作要求
1. **代码审查**：所有合并请求需经过至少一名成员审查。
2. **持续反馈**：定期同步开发与测试进展，及时调整计划。
3. **责任到人**：每个功能由开发者主导测试并确保质量，测试记录归档至项目Wiki或指定文档库。

通过以上规范，旨在形成**开发→测试→记录→集成**的闭环流程，确保交付质量，并为后续维护、BUG修复与优化提供完整依据。
